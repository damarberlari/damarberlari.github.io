graphdata =  [
    {"key":0,
    "director" : "Christopher Nolan",
            "source"    : "Rotten Tomatoes, Box Office Mojo",
            "movie" : [
            {
               "key" : 0,
               "name" : "Memento",
               "year" : 2000,
               "budget" : 9,
               "revenue" : 39.7,
               "rating" : 92,
               "img_url" : "http://www.gstatic.com/tv/thumb/movieposters/28578/p28578_p_v8_af.jpg",
               "selected" : false,
               "consensus" : "Christopher Nolan skillfully guides the audience through Memento's fractured narrative, seeping his film in existential dread."
            },{
                "key" : 1,
               "name" : "Insomnia",
               "year" : 2002,
               "budget" : 42,
               "revenue" : 113.7,
               "rating" : 92,
               "color"  : "#E95E2B",
               "img_url" : "http://www.gstatic.com/tv/thumb/movieposters/30021/p30021_p_v8_aa.jpg",
               "selected" : false,
               "consensus" : "Driven by Pacino's performance, Insomnia is a smart and riveting psychological drama."
            },{
                "key" : 2,
               "name" : "Batman Begins",
               "year" : 2005,
               "budget" : 150,
               "revenue" : 374.2,
               "rating" : 85,
               "color"  : "#E3632C",
               "img_url" : "http://www.gstatic.com/tv/thumb/movieposters/35903/p35903_p_v8_ae.jpg",
               "selected" : true,
               "consensus" : "Brooding and dark, but also exciting and smart, Batman Begins is a film that understands the essence of one of the definitive superheroes."
            },{
                "key" : 3,
               "name" : "The Prestige",
               "year" : 2006,
               "budget" : 40,
               "revenue" : 109.7,
               "rating" : 76,
               "color"  : "#DB692D",
               "img_url" : "http://www.gstatic.com/tv/thumb/movieposters/161581/p161581_p_v8_aa.jpg",
               "selected" : false,
               "consensus" : "Full of twists and turns, The Prestige is a dazzling period piece that never stops challenging the audience."
            },{
                "key" : 4,
               "name" : "The Dark Knight",
               "year" : 2008,
               "budget" : 185,
               "revenue" : 1004.5,
               "rating" : 94,
               "color"  : "#EA5D2B",
               "img_url" : "http://www.gstatic.com/tv/thumb/movieposters/173378/p173378_p_v8_aa.jpg",
               "selected" : false,
               "consensus" : "Dark, complex and unforgettable, The Dark Knight succeeds not just as an entertaining comic book film, but as a richly thrilling crime saga."
            },{
                "key" : 5,
               "name" : "Inception",
               "year" : 2010,
               "budget" : 160,
               "revenue" : 825.5,
               "rating" : 86,
               "color"  : "#E4622C",
               "img_url" : "http://t2.gstatic.com/images?q=tbn:ANd9GcRo9vfJCM6dzPkZHIHBVCtlJnAnew9Ai26kEdrli0-tfmatmciD",
               "selected" : false,
               "consensus" : "Smart, innovative, and thrilling, Inception is that rare summer blockbuster that succeeds viscerally as well as intellectually."
            },{
                "key" : 6,
               "name" : "The Dark Knight Rises",
               "year" : 2012,
               "budget" : 250,
               "revenue" : 1084.4,
               "rating" : 88,
               "color"  : "#E5612C",
               "img_url" : "http://t1.gstatic.com/images?q=tbn:ANd9GcQSGF8_VbDqKF0B_4IQ0NF87VMDSy7_MPKryawR-qLnSIPQwo5z",
               "selected" : false,
               "consensus" : "The Dark Knight Rises is an ambitious, thoughtful, and potent action film that concludes Christopher Nolan's franchise in spectacular fashion."
            },{
                "key" : 7,
               "name" : "Interstellar",
               "year" : 2014,
               "budget" : 165,
               "revenue" : 675,
               "rating" : 71,
               "color"  : "#D76C2E",
               "img_url" : "http://t1.gstatic.com/images?q=tbn:ANd9GcRf61mker2o4KH3CbVE7Zw5B1-VogMH8LfZHEaq3UdCMLxARZAB",
               "selected" : false,
               "consensus" : "Interstellar represents more of the thrilling, thought-provoking, and visually resplendent filmmaking moviegoers have come to expect from writer-director Christopher Nolan, even if its intellectual reach somewhat exceeds its grasp."
            }
            ]},
            {"key":1,
            "director" : "Alejandro Gonzalez Inarritu",
            "source"    : "Rotten Tomatoes, Box Office Mojo, The Numbers",
            "movie" : [
            {
                "key" : 0,
               "name" : "Amores Perros",
               "year" : 2001,
               "budget" : 2,
               "revenue" : 20.9,
               "rating" : 92,
               "color"  : "#E95E2B",
               "img_url" : "http://t0.gstatic.com/images?q=tbn:ANd9GcS0EpBQFNPv6xOw_8CJX3H4WMKk0w7e9MGVbPH-HXzjMi45Wdvi",
               "selected" : false
            },{
                "key" : 1,
               "name" : "21 Grams",
               "year" : 2003,
               "budget" : 20,
               "revenue" : 60.4,
               "rating" : 80,
               "color"  : "#E95E2B",
               "img_url" : "http://www.gstatic.com/tv/thumb/movieposters/32921/p32921_p_v8_ag.jpg",
               "selected" : false
            },{
                "key" : 2,
               "name" : "Babel",
               "year" : 2006,
               "budget" : 20,
               "revenue" : 135.3,
               "rating" : 69,
               "color"  : "#E3632C",
               "img_url" : "http://www.gstatic.com/tv/thumb/movieposters/161617/p161617_p_v8_aa.jpg",
               "selected" : false
            },{
                "key" : 3,
               "name" : "Biutiful",
               "year" : 2010,
               "budget" : 35,
               "revenue" : 25.1,
               "rating" : 64,
               "color"  : "#DB692D",
               "img_url" : "http://www.gstatic.com/tv/thumb/movieposters/8292640/p8292640_p_v8_ab.jpg",
               "selected" : false
            },{
                "key" : 4,
               "name" : "Birdman",
               "year" : 2014,
               "budget" : 18,
               "revenue" : 103.2,
               "rating" : 91,
               "color"  : "#EA5D2B",
               "img_url" : "http://t0.gstatic.com/images?q=tbn:ANd9GcQdWKWF2aW3BeYRdEC3pAE5mbJUgd4myk6KyRUy6xmGdFixe5Rn",
               "selected" : true
            },{
                "key" : 5,
               "name" : "The Revenant",
               "year" : 2015,
               "budget" : 135,
               "revenue" : 532.9,
               "rating" : 82,
               "color"  : "#E4622C",
               "img_url" : "http://t1.gstatic.com/images?q=tbn:ANd9GcS5yuCSZqK5Hha5lElqZr2SCYVY-sYycKZ8PJ8POfNQkOmSuo5B",
               "selected" : false
            }]},
            {"key":2,
            "director" : "David Fincher",
            "source"    : "Rotten Tomatoes, Box Office Mojo, The Numbers",
            "movie" : [
            {
                "key" : 0,
               "name" : "Alien 3",
               "year" : 1992,
               "budget" : 50,
               "revenue" : 159.8,
               "rating" : 44,
               "color"  : "#E95E2B",
               "img_url" : "http://www.gstatic.com/tv/thumb/movieposters/14014/p14014_p_v8_ab.jpg",
               "selected" : false
            },{
                "key" : 1,
               "name" : "Seven",
               "year" : 1995,
               "budget" : 33,
               "revenue" : 327.3,
               "rating" : 80,
               "color"  : "#E95E2B",
               "img_url" : "http://t1.gstatic.com/images?q=tbn:ANd9GcRod45bAdo2Os6THPDA2qDH2qIwNtqBlrjfZGGn_J2ppx6DIhhU",
               "selected" : false
            },{
                "key" : 2,
               "name" : "The Game",
               "year" : 1997,
               "budget" : 50,
               "revenue" : 109.4,
               "rating" : 72,
               "color"  : "#E3632C",
               "img_url" : "http://t2.gstatic.com/images?q=tbn:ANd9GcTQEmgrOXMpP7CnpeJOgYYasTGEvQakL8RVpVIoQ-XdbdOAyoGK",
               "selected" : false
            },{
                "key" : 3,
               "name" : "Fight Club",
               "year" : 1999,
               "budget" : 63,
               "revenue" : 100.8,
               "rating" : 79,
               "color"  : "#DB692D",
               "img_url" : "http://www.gstatic.com/tv/thumb/movieposters/23069/p23069_p_v8_ad.jpg",
               "selected" : true
            },{
                "key" : 4,
               "name" : "Panic Room",
               "year" : 2002,
               "budget" : 48,
               "revenue" : 196.4,
               "rating" : 76,
               "color"  : "#EA5D2B",
               "img_url" : "http://www.gstatic.com/tv/thumb/movieposters/29417/p29417_p_v8_af.jpg",
               "selected" : false
            },{
                "key" : 6,
               "name" : "The Curious Case of Benjamin Button",
               "year" : 2008,
               "budget" : 150,
               "revenue" : 333.9,
               "rating" : 72,
               "color"  : "#E5612C",
               "img_url" : "http://www.gstatic.com/tv/thumb/movieposters/170920/p170920_p_v8_am.jpg",
               "selected" : false
            },{
                "key" : 7,
               "name" : "The Social Network",
               "year" : 2010,
               "budget" : 40,
               "revenue" : 224.9,
               "rating" : 96,
               "color"  : "#D76C2E",
               "img_url" : "http://t2.gstatic.com/images?q=tbn:ANd9GcTj268E01VcjLW3fNrO2z10WpXs7WMeciAB9wYSOA2DI-le_NQH",
               "selected" : false
            },{
                "key" : 8,
               "name" : "The Girl with the Dragon Tattoo",
               "year" : 2011,
               "budget" : 90,
               "revenue" : 232.6,
               "rating" : 86,
               "color"  : "#D76C2E",
               "img_url" : "http://www.gstatic.com/tv/thumb/movieposters/8702416/p8702416_p_v8_ah.jpg",
               "selected" : false
            },{
                "key" : 9,
               "name" : "Gone Girl",
               "year" : 2014,
               "budget" : 61,
               "revenue" : 369.3,
               "rating" : 88,
               "color"  : "#D76C2E",
               "img_url" : "http://t1.gstatic.com/images?q=tbn:ANd9GcTwcWs6CK22NdvXZH0CbigLxoV-N3GIJypphImFYYv1vG_VKXTQ",
               "selected" : false
            },{
                "key" : 5,
               "name" : "Zodiac",
               "year" : 2007,
               "budget" : 65,
               "revenue" : 84.7,
               "rating" : 89,
               "color"  : "#E4622C",
               "img_url" : "http://www.gstatic.com/tv/thumb/movieposters/162782/p162782_p_v8_aa.jpg",
               "selected" : false
            }
            ]},
            {"key":3,
            "director" : "James Cameron",
            "source"    : "Rotten Tomatoes, Box Office Mojo, The Numbers",
            "movie" : [
               {
                "key" : 0,
               "name" : "The Terminator",
               "year" : 1984,
               "budget" : 6.4,
               "revenue" : 78.4,
               "rating" : 100,
               "img_url" : "http://t1.gstatic.com/images?q=tbn:ANd9GcRHzSaUCOKu1RwS-bfbaUeeo_I1JcBkiuJRjBElvJi7qsHXkUkJ",
               "selected" : false,
               "consensus" : "With its impressive action sequences, taut economic direction, and relentlessly fast pace, it's clear why The Terminator continues to be an influence on sci-fi and action flicks."
                } ,
                {
                    "key" : 1,
                "name" : "Aliens",
                "year" : 1986,
                "budget" : 17,
                "revenue" : 131,
                "rating" : 98,
                "img_url" : "http://www.gstatic.com/tv/thumb/movieposters/9384/p9384_p_v8_as.jpg",
                "selected" : false,
                "consensus" : "While Alien was a marvel of slow-building, atmospheric tension, Aliens packs a much more visceral punch, and features a typically strong performance from Sigourney Weaver."  
                },
                {
                    "key" : 2,
                "name" : "The Abyss",
                "year" : 1989,
                "budget" : 70,
                "revenue" : 90,
                "rating" : 89,
                "img_url" : "http://www.gstatic.com/tv/thumb/movieposters/11774/p11774_p_v8_aa.jpg",
                "selected" : false,
                "consensus" : "The utterly gorgeous special effects frequently overshadow the fact that The Abyss is also a totally gripping, claustrophobic thriller, complete with an interesting crew of characters."  
                },
                {
                    "key" : 3,
                "name" : "Terminator 2: Judgment Day",
                "year" : 1991,
                "budget" : 102,
                "revenue" : 519.8,
                "rating" : 93,
                "img_url" : "http://t1.gstatic.com/images?q=tbn:ANd9GcS5J6Ay6y1UT7WAI4U7Zm2KDYITrvfOI3vmaCNdGhx_0jmWiI1d",
                "selected" : false,
                "consensus" : "T2 features thrilling action sequences and eye-popping visual effects, but what takes this sci-fi/ action landmark to the next level is the depth of the human (and cyborg) characters."  
                },
                {
                    "key" : 4,
                "name" : "True Lies",
                "year" : 1994,
                "budget" : 115,
                "revenue" : 378.9,
                "rating" : 72,
                "img_url" : "http://t2.gstatic.com/images?q=tbn:ANd9GcSwsBywFdF5JJdega2zTOHY8QcpiZmF1sSbTKrOwc4jJBn3dFGS",
                "consensus" : "If it doesn't reach the heights of director James Cameron's and star Arnold Schwarzenegger's previous collaborations, True Lies still packs enough action and humor into its sometimes absurd plot to entertain."  
                },
                {
                    "key" : 5,
                "name" : "Titanic",
                "year" : 1997,
                "budget" : 200,
                "revenue" : 2186.7,
                "rating" : 88,
                "img_url" : "http://t0.gstatic.com/images?q=tbn:ANd9GcQhYjUIu2o5v5u3rfJpCq5Cz0Q9WK--XdYxai_N2d0ImohPiIOp",
                "selected" : true,
                "consensus" : "A mostly unqualified triumph for James Cameron, who offers a dizzying blend of spectacular visuals and old-fashioned melodrama."  
                },
                {
                    "key" : 6,
                "name" : "Avatar",
                "year" : 2009,
                "budget" : 425,
                "revenue" : 2787.9,
                "rating" : 83,
                "img_url" : "http://t0.gstatic.com/images?q=tbn:ANd9GcQCfmvrE4fMo2cd8esc7mDZPtFSJThAujddMPkRtti1_ij6u-jp",
                "selected" : false,
                "consensus" : "It might be more impressive on a technical level than as a piece of storytelling, but Avatar reaffirms James Cameron's singular gift for imaginative, absorbing filmmaking."  
                }
            ]
            }
    ];


var d3Chart = {};

d3Chart.create = function(el, state) {
  var svg = d3.select(el).append('svg')
      .attr("class","svg-master")
      .attr('width', '100%')
      .attr('height', '100%') 
      .attr('viewBox',"0 0 640 960");

  svg.append('g').attr('class', 'movie-triangle');
  svg.append('g').attr('class', 'detail');
  svg.append('g').attr('class', 'axis');
  svg.append('g').attr('class', 'title');
  svg.append('g').attr('class', 'legend');
  svg.append('g').attr('class', 'navigator');
  
      var pattern = d3.select(el).selectAll(".detail").append("defs")
	.selectAll("pattern").data(state.movie).enter()
	.append("pattern")
	.attr("id", function(d,m) {return "bg-"+m})
	.attr('width', 1)
	.attr('height',1)
	.append("image")
	.attr("xlink:href", function(d) {return d.img_url})
	.attr("x",0)
	.attr("y",0)
	.attr('width', 128)
	.attr('height', 191);

  d3Chart.update(el, state, 0);
};

d3Chart.update = function(el, state, counter) {
  scale = this._scale(state.movie);
  this._drawTriangle(el, ".movie-triangle", scale, state.movie, counter);
  this._drawAxis(el, ".axis", scale, state.movie);
  this._drawTitle(el, ".title", scale, state);
  this._drawDetail(el, ".detail", scale, state.movie, counter);
  this._drawNavigator(el, ".navigator", scale, state, counter);
  //this._drawLegend(el, ".legend", scale, state.movie);
};

d3Chart.destroy = function(el) {
 d3.selectAll(el).select(".svg-master").remove();
  // Any clean-up would go here
  // in this example there is nothing to do
};

d3Chart._scale = function(dataset) {
    
var array = Object.keys(dataset).map(function(key){return dataset[key].revenue})
var maxRev = Math.max.apply(null,array)
var w = 640;
var h = 960;
            
var xScale =    d3.scaleLinear()
                .domain([0,dataset.length-1])
                .range([150, w-150]);
                     
                     
var yScale =    d3.scaleLinear()
                .domain([0, maxRev])
                .range([0, h-480]);
                
return {w: w, h: h, xScale: xScale, yScale: yScale}
}

d3Chart._drawTriangle = function(el, className, scale, dataset, counter) {
var w = scale.w;
var h = scale.h;
var xScale = scale.xScale;
var yScale = scale.yScale;

            
var movTriangle =   d3.select(el).selectAll(className).selectAll(".triangle-main")
                    .data(dataset.filter(function(d){return d.key == counter}))
                    
                    movTriangle
                    .enter()
                    .append("polygon")
                    .attr("class","triangle-main")
                    .attr("points", function(d,m) {return w/2+","+(h-320)+
                          " "+w/2+","+(h-320)+
                          " "+w/2+","+(h-320)
                          })
                    .attr("fill", function(d){return "rgb(255, "+(230-d.rating)+", 80)"})
                    .attr("fill-opacity", 0.8)
                    .each(function(d,m){
                    
                    var movLayout = d3.select(el).selectAll(className).append("polygon")
                        .attr("class","triangle-layout")
                        .attr("points", function() {return w/2+","+(h-320)+
                              " "+w/2+","+(h-320)+
                              " "+w/2+","+(h-320)
                              })
                        .attr("fill", function(){return "rgb(255, "+(230-d.rating)+", 80)"})
                        .attr("fill-opacity", 0.8)
                        .attr("pointer-events","none");
                    });
                    
                    d3.select(el).selectAll(className).selectAll(".triangle-main")
                    .data(dataset.filter(function(d){return d.key == counter}))
                    .transition()
                    .ease(d3.easeCubic)
                    .duration(700)
                    .attr("points", function(d,m) {return w/2+","+(h-yScale(d.revenue)-320)+
                          " "+(w/2-yScale(d.budget))+","+(h-320)+
                          " "+(w/2+yScale(d.budget))+","+(h-320)
                          })
                    .attr("cursor","pointer")
                    .each(function(d,m){
                        
                        d3.select(el).selectAll(className).selectAll(".triangle-layout")
                        .transition()
                        .ease(d3.easeCubic)
                        .duration(700)
                        .attr("points", function() {return w/2+","+(h-yScale(d.revenue)-320)+
                              " "+(w/2-yScale(d.budget))+","+(h-320)+
                              " "+(w/2)+","+(h-320)
                              })
                        
                    });
            
                    movTriangle
                    .on("mouseover", function(d,k) {
                        d3.event.preventDefault();
                        d3.select(this)
                        .attr("fill-opacity", 0.9);
                        
                        var id=d.key;
                        
                        d3.selectAll(".detail-box").data(dataset).classed("hidden",function(d,m){if(d.key==id) {return false} else {return true}})
                    })
                    .on("touchenter", function(){
                        d3.event.preventDefault();
                    })
                    .on("mouseout", function() {
                        d3.select(this)
                        .attr("fill-opacity", 0.8);
                    });
}

d3Chart._drawAxis = function(el,className, scale, dataset) {
var w = scale.w;
var h = scale.h;
var xScale = scale.xScale;
var yScale = scale.yScale;
    
var dots =   d3.select(el).selectAll(className).selectAll("circle")
                    .data(dataset.filter(function(d){return d.key==0}))
                    .enter()
                    .append("circle")
                    .attr("class","dots")
                    .attr("cx",w/2)
                    .attr("cy", h-320)
                    .attr("r",8)
                    .attr("pointer-events","none");

}

d3Chart._drawTitle = function(el,className, scale, dataset) {
var defs = d3.select(el).selectAll(className)
            .append("defs")

var filter = defs.append("filter")
            .attr("x",0)
            .attr("y",0)
            .attr("width",1)
            .attr("height",1)
            .attr("id","solid")
            
filter.append("feFlood")
.attr("flood-color","white")

filter.append("feComposite")
.attr("in","SourceGraphic")


var title = d3.select(el).selectAll(className)
                .append("text")
                .attr("class","chartTitle")
                .attr("filter","url(#solid)")
                .attr("x",320)
                .attr("y",80)
                .attr("font-size", 40)
                .attr("text-anchor","middle")
                .text(dataset.director.toUpperCase())
                .on("click",function(){
                    d3Chart.destroy(el);
                    if(dataset.key==graphdata.length-1)
                    {d3Chart.create(el,graphdata[0])}
                    else {d3Chart.create(el,graphdata[dataset.key+1])};   
                });
      
      
      d3.select(el).selectAll(className)
                .append("text")
                .attr("class","chartTitle")
                .attr("filter","url(#solid)")
                .attr("x",320)
                .attr("y",135)
                .attr("font-size", 40)
                .attr("text-anchor","middle")
      .text("MOVIE GUIDE");
      
      d3.select(el).selectAll(className)
                .append("text")
                .attr("class","subtitle")
                .attr("x",320)
                .attr("y",165)
                .attr("font-size", 12)
                .attr("text-anchor","middle")
      .text("Source: "+dataset.source);
      
      
}

d3Chart._drawDetail = function(el,className,scale,dataset,counter) {
var w = scale.w;
var h = scale.h;
var xScale = scale.xScale;
var yScale = scale.yScale;

var detailGroup = d3.select(el).selectAll(className).selectAll(".detail-box")
                    .data(dataset)
                    
                    detailGroup
                    .enter()
                    .append("g")
                    .attr("class","detail-box")
                    .classed("hidden",function(d){return !(d.key==counter)})
                    .each(function(d,m){
                        d3.select(this)
                        .append("rect")
                        .attr("class","posters")
                        .attr("x", 80)
                        .attr("y", 700)
                        .attr("width",128)
                        .attr("height",191)
                        .attr("fill", function(){return "url(#bg-"+m+")"})
                        .attr("stroke","white")
                        .attr("stroke-width",1)
                        .attr("pointer-events","none");
                        
                        d3.select(this)
                        .append("text")
                        .attr("class","detailTitle")
                        .attr("x",235)
                        .attr("y",720)
                        .attr("font-size", 24)
                        .attr("start","begin")
                        .text(function(){return d.name.toUpperCase()+" ("+d.year+")"});
                        
                        
                        //d3.select(this)
                        //.append("path")
                        //.attr("class", "line")
                        //.attr("d", function(){return "M"+(w/2)+" "+(h-320)+" L"+(w/2)+" "+(h-320)+" L"+(w/2)+" "+(h-320)})
                        //.attr("stroke","white")
                        //.attr("stroke-width",2)
                        //.attr("fill","none")
                        //.transition()
                        //.ease(d3.easeCubic)
                        //.duration(700)
                        //.attr("d", function(){return "M"+(w/2-yScale(d.budget))+" "+(h-320)+" L"+(w/2)+" "+(h-320-yScale(d.revenue))+" L"+(w/2+yScale(d.budget))+" "+(h-320)+ " Z"});
                        //
                        
                        var loc=[242,330,440];
                        
                        d3.select(this)
                        .selectAll("legend-circle")
                        .data(["rgb(255, "+(230-d.rating)+", 80)","crimson","green"])
                        .enter()
                        .append("circle")
                        .attr("class","legend-circle")
                        .attr("r",6)
                        .attr("cx",function(d,m){return loc[m]})
                        .attr("cy",740)
                        .attr("fill",function(d){return d})
                        
                        d3.select(this)
                        .selectAll("legend-data")
                        .data([d.rating,d.budget,d.revenue])
                        .enter()
                        .append("text")
                        .attr("class","legend-data")
                        .attr("x",function(d,m){return loc[m]+15})
                        .attr("y",747)
                        .attr("fill","white")
                        .attr("font-size", 18)
                        .attr("start","begin")
                        .text(function(d,m){
                            if(m==0){return d+"%"} else {return d+" Mil"}
                            }
                              );
                        
                        d3.select(this)
                        .append("text")
                        .attr("class","detail-consensus")
                        .attr("x",235)
                        .attr("y",760)
                        .attr("dy",24)
                        .attr("font-size", 20)
                        .attr("text-anchor","start")
                        .text(function(){return d.consensus})
                        .call(d3Chart._wrapText,300,5);
                        
                    })
   
   
                    detailGroup
                    .classed("hidden",function(d){return !(d.key==counter)})
    //var poster =   d3.select(el).selectAll(className).selectAll("rect")
    //                .data(dataset)
    //                .enter()
    //                .append("rect")
    //                .attr("class","posters")
    //                .classed("hidden",function(d){return !d.selected})
    //                .attr("x", 120)
    //                .attr("y", 250)
    //                .attr("width",94)
    //                .attr("height",140)
    //                .attr("fill", function(d,m){return "url(#bg-"+m+")"})
    //                .attr("stroke","white")
    //                .attr("stroke-width",1)
    //                .attr("pointer-events","none");
}

d3Chart._drawLegend = function(el,className,scale,dataset) {
var w = scale.w;
var h = scale.h;
var xScale = scale.xScale;
var yScale = scale.yScale;

var xLegend = d3.select(el).selectAll(className).selectAll("#budget-line")
                    .data(dataset.filter(function(d){return d.selected}))
                    .enter()
                    .append("path")
                    .attr("class","legend-line")
                    .attr("id","budget-line")
                    .attr("d",function(d){
                        return "M"+(xScale(d.key))+" "+(h-90-yScale(d.revenue))+" L"+(xScale(d.key)-yScale(d.budget))+" "+(h-90-yScale(d.revenue))+" "+
                        "M"+(xScale(d.key))+" "+(h-90-yScale(d.revenue)-5)+" L"+xScale(d.key)+" "+(h-90-yScale(d.revenue)+5)+" "+
                        "M"+(xScale(d.key)-yScale(d.budget))+" "+(h-90-yScale(d.revenue)-5)+" L"+(xScale(d.key)-yScale(d.budget))+" "+(h-90-yScale(d.revenue)+5)
                        });
                    
var yLegend = d3.select(el).selectAll(className).selectAll("#revenue")
                    .data(dataset.filter(function(d){return d.selected}))
                    .enter()
                    .append("path")
                    .attr("class","legend-line")
                    .attr("id","revenue")
                    .attr("d",function(d){
                        return "M"+(xScale(d.key)-yScale(d.budget)-10)+" "+(h-80-yScale(d.revenue))+" L"+(xScale(d.key)-yScale(d.budget)-10)+" "+(h-80)+" "+
                        "M"+(xScale(d.key)-yScale(d.budget)-15)+" "+(h-80-yScale(d.revenue))+" L"+(xScale(d.key)-yScale(d.budget)-5)+" "+(h-80-yScale(d.revenue))
                    });
                    
 var L =             d3.select(el).selectAll(className).selectAll("#budget-text")
                        .data(dataset.filter(function(d){return d.selected}))
                        .enter()
                        .append("text")
                        .attr("class","legend-text")
                        .attr("id","budget-text")
                        .attr("x",function(d,m){return xScale(d.key)-(yScale(d.budget)/2)})
                        .attr("y",function(d,m){return h-80-yScale(d.revenue)-20})
                        .attr("font-size", 12)
                        .attr("text-anchor","middle")
                        .text("Budget");
                        
var M =             d3.select(el).selectAll(className).selectAll("#revenue-text")
                        .data(dataset.filter(function(d){return d.selected}))
                        .enter()
                        .append("text")
                        .attr("class","legend-text")
                        .attr("id","revenue-text")
                        .attr("x",function(d,m){return xScale(d.key)-yScale(d.budget)-20})
                        .attr("y",function(d,m){return h-80-yScale(d.revenue)/2})
                        .attr("font-size", 12)
                        .attr("text-anchor","end")
                        .text("Revenue"); 
                    

}

d3Chart._drawNavigator = function(el,className, scale, dataset, counter) {
var prevButton = d3.select(el).selectAll(className).selectAll("#prev-button")
                    .data([0])
                    .enter()
                    .append("path")
                    .attr("class","button")
                    .attr("id","prev-button")
                    .attr("d","M20 800 L40 780 L40 820 Z");
                    
                    d3.select(el).selectAll(className).selectAll("#prev-button")
                    .attr("opacity",function(){if(counter==0){return 0.2}else{return 0.9}})
                    .on("click",function(){
                        if(counter>0){
                            d3Chart.update(el,dataset, counter-1);
                            }
                        else{d3Chart.update(el,dataset, 0)}
                    });
                    
var nextButton = d3.select(el).selectAll(className).selectAll("#next-button")
                    .data([0])
                    .enter()
                    .append("path")
                    .attr("class","button")
                    .attr("id","next-button")
                    .attr("d","M620 800 L600 780 L600 820 Z");
                    
                    d3.select(el).selectAll(className).selectAll("#next-button")
                    .attr("opacity",function(){if(counter==dataset.movie.length-1){return 0.2}else{return 0.9}})
                    .on("click",function(){
                        if(counter>=dataset.movie.length-1){d3Chart.update(el,dataset,dataset.movie.length-1)}
                        else{d3Chart.update(el,dataset,counter+1)}
                    });
}

d3Chart._wrapText = function (selection, width, maxLine) {
    selection.each(function() {
                            var text = d3.select(this),
                            words = text.text().split(/\s+/).reverse(),
                            word,
                            line = [],
                            lineNumber = 1, // ems
                            x = text.attr("x")
                            y = text.attr("y"),
                            dy = parseFloat(text.attr("dy")),
                            tspan = text.text(null).append("tspan").attr("x", x).attr("y", y);
                            
                            while (word = words.pop()) {
                            line.push(word);
                            tspan.text(line.join(" "));
                            if (tspan.node().getComputedTextLength() > width) {
                                line.pop();
                                tspan.text(line.join(" "));
                                line = [word];
                                if(lineNumber<maxLine) {tspan = text.append("tspan").attr("x", x).attr("y", y).attr("dy", ++lineNumber * dy).text(word)};
                                }
                            }
                        });
}

var el=".d3-content";

d3Chart.create(el,graphdata[0]);

